# 系统逻辑说明文档

## 1. 标签说明：本地 (Local) vs 已下载 (Downloaded)

这两个标签代表了歌曲在系统中的不同状态，但在界面上我们进行了优化显示：

*   **本地 (Local)**:
    *   **含义**: 指的是系统在扫描您的硬盘文件夹时发现的音频文件。这些文件是您通过其他方式（手动复制、其他软件下载）已经保存在硬盘上的。
    *   **扫描目录**: 也就是您问的路径，系统默认只扫描项目根目录下的两个文件夹：
        1.  `/audio_cache` (音频缓存目录，默认下载也是这里)
        2.  `/favorites` (收藏目录)
    *   **界面显示**: 如果歌曲有对应的本地文件，界面上会优先显示 "本地" 标签。此时系统会自动隐藏 "downloaded" 标签，避免重复。

*   **已下载 (Downloaded)**:
    *   **含义**: 指的是歌曲的状态 (Status)。通常表示这首歌是通过本系统从网络下载成功的，或者本地扫描到的文件经过元数据补全后被确认为完整文件。
    *   **界面显示**: 只有当一首歌的状态是 `DOWNLOADED`，但**没有**被识别为 `source=local` (例如刚下载完但在某些视图下) 时，才可能显示此标签。但在最新优化后，只要文件在磁盘上，通常都会归类为 "本地" 显示，"downloaded" 主要用于后台状态判断。

## 2. 扫描路径详情

系统目前扫描的“本地文件夹”是相对于程序运行目录的以下两个位置：
*   `./audio_cache/`
*   `./favorites/`

如果您手动将 mp3/flac/wav 等文件放入这两个文件夹，点击“扫描本地文件”功能后，它们就会被识别为“本地”歌曲。

## 3. 发布时间 (Publish Time) 处理逻辑

系统对歌曲发布时间的处理逻辑如下：

1.  **优先来源**:
    *   在合并歌曲信息时，系统会**优先使用 QQ 音乐**作为数据源的发布时间。这是因为根据您的反馈，QQ 音乐的日期数据通常更准确。
    *   如果 QQ 音乐没有数据，则尝试使用网易云音乐或其他来源的日期。

2.  **日期缺失处理 (无日期)**:
    *   如果所有来源都没有提供有效的发布时间，系统会在排序和比对时将其视为 `0000-00-00` (很久以前)。
    *   在数据库中，该字段会保持为 `NULL` 或空。

3.  **排序规则**:
    *   在“最新发布”列表或排序时，系统优先按**发布时间**从新到旧排序。
    *   如果发布时间相同（或都没有日期），则按**创建时间**（即添加到系统的时间）从新到旧排序。这保证了即使没有发布日期的歌曲，新添加的也会排在相对靠前（如果是刚添加的）或靠后的位置，不会随机乱序。
