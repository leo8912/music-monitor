# 前端数据需求结构化文档 (Data Specification)

> **目的**: 统一前后端数据交换格式，明确各实体的核心字段，减少沟通成本。

---

## 1. 核心模型接口 (Core Schemas)

### 1.1 歌曲对象 (Song)
前端在播放器、列表、历史记录中通用的模型。
- **id**: `int` (数据库唯一 ID)
- **unique_key**: `string` (格式：`provider_mediaid`, 例如 `qqmusic_12345`)
- **title**: `string` (歌名)
- **artist**: `string` (歌手名，多位歌手以 `/` 分格)
- **album**: `string` (专辑名)
- **cover_url**: `string` (图片完整 URL)
- **status**: `enum` (`PENDING` | `DOWNLOADED` | `FAILED` | `PENDING_METADATA`)
- **is_favorite**: `boolean` (收藏状态)
- **local_audio_path**: `string` (后端相对路径，用于文件查找)

---

## 2. 跨层交互规范 (Cross-layer Interaction)

### 2.1 路径管理 (Path Mapping)
- **前端需知**: 不要直接通过数据库存储的 `local_path` 拼接 URL。
- **后端保证**: 通过 `/api/audio/{filename}` 接口映射。物理位置迁移（Cache -> Favorite）对前端应是透明的，仅需更新 `unique_key` 对应的对象属性。

### 2.2 搜索打分与展示
- **去重逻辑**: 后端负责根据 `title` + `artist` 的小写归一化进行聚合。
- **展示顺序**: 优先推荐 `source: "qqmusic"` 且包含封面图片的条目。

---

## 3. 后端待优化/待支持项 (Backlog for BE)
1.  **分词搜索支持**: 目前仅支持精准匹配及简单包含，建议引入模糊搜索。
2.  **播放进度同步**: 目前播放器进度完全在前端内存中，建议新增 `PATCH /api/player/progress` 同步接口。
3.  **歌词解析**: 建议后端统一将歌词转为 `.lrc` 标准格式返回，而非原始字符串。

---

> [!NOTE]
> **实时性说明**: 
> 下载任务的状态变更（PENDING -> DOWNLOADED）建议通过 `/api/download/status/{task_id}` 进行短轮询获取，当前暂未部署 WebSocket。
